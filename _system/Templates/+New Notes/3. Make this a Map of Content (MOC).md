<%*
// METADJUST - AUTO MOC TOGGLE
const templateType = "create";

// Get current file
const file = tp.file.find_tfile(tp.file.title);
if (file) {
    // Get current type value if it exists
    let currentType = "";
    
    try {
        const dv = this.app.plugins.plugins["dataview"].api;
        const currentPage = dv.page(file.path);
        currentType = (currentPage.type || "").toLowerCase();
    } catch {
        // Silently continue if dataview isn't available or type isn't set
    }
    
    // If current type is not 'moc', set it to 'moc'
    if (currentType !== "moc") {
        // Update YAML frontmatter to moc
        await app.fileManager.processFrontMatter(file, (frontmatter) => {
            frontmatter.type = "moc";
        });
        
        // Optional: Console log instead of Notice
        console.log("Note type changed to MOC");
    } else {
        // If it's already 'moc', ask for confirmation before changing to 'note'
        const confirmOptions = ["Downgrade to note", "Keep as MOC"];
        const confirmResult = await tp.system.suggester(
            confirmOptions,
            [true, false],
            false,
            "This is already a MOC. Change to note?"
        );
        
        // If user confirms, change to 'note'
        if (confirmResult === true) {
            await app.fileManager.processFrontMatter(file, (frontmatter) => {
                frontmatter.type = "note";
            });
            
            console.log("Note type changed to note");
        } else {
            console.log("Note remains as MOC");
        }
    }
}
-%>